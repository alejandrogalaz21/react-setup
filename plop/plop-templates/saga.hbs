import axios from 'axios'
import { push } from 'connected-react-router'
import { call, put, take, all, takeLatest } from 'redux-saga/effects'

import {
  {{constantCase name}}_CREATE_REQUEST,
  {{constantCase name}}_GET_ALL_REQUEST,
  {{constantCase name}}_GET_ONE_REQUEST,
  {{constantCase name}}_UPDATE_REQUEST,
  {{camelCase name}}CreateSuccess,
  {{camelCase name}}CreateFailure,
  {{camelCase name}}GetAllSuccess,
  {{camelCase name}}GetAllFailure,
  {{camelCase name}}GetOneSuccess,
  {{camelCase name}}GetOneFailure,
  {{camelCase name}}UpdateSuccess,
  {{camelCase name}}UpdateFailure
} from './{{camelCase name}}.redux'

export function* {{camelCase name}}Create({ payload }) {
  try {
    // POST REQUEST
    const { data } = yield call(axios.post, '/api/{{camelCase name}}s', payload)
    yield put({{camelCase name}}CreateSuccess(data))
    yield alert('registro guardado')
  } catch (error) {
    console.log(error)
    yield put({{camelCase name}}CreateFailure('Fail {{camelCase name}}s create request'))
  }
}

export function* {{camelCase name}}GetAll() {
  try {
    // GET REQUEST
    const { data } = yield call(axios.get, '/api/{{camelCase name}}s')
    yield put({{camelCase name}}GetAllSuccess(data))
  } catch (error) {
    yield put({{camelCase name}}GetAllFailure('Fail {{camelCase name}}s read many request'))
  }
}

export function* {{camelCase name}}GetOne({ payload }) {
  try {
    // GET REQUEST
    const { data } = yield call(axios.get, `/api/{{camelCase name}}s/${payload}`)
    yield put({{camelCase name}}GetOneSuccess(data))
  } catch (error) {
    yield put({{camelCase name}}GetOneFailure('Fail {{camelCase name}}s read one request'))
  }
}

export function* {{camelCase name}}Update({ payload }) {
  try {
    // POST REQUEST
    yield call(axios.put, `/api/{{camelCase name}}s/${payload.id}`, payload)
    yield put({{camelCase name}}UpdateSuccess(payload))
    yield alert('Registro actualizado')
  } catch (error) {
    console.log(error)
    yield put({{camelCase name}}UpdateFailure('Fail {{camelCase name}}s update request'))
  }
}

export function* {{camelCase name}}sSagas() {
  yield all([
    takeLatest({{constantCase name}}_CREATE_REQUEST, {{camelCase name}}Create),
    takeLatest({{constantCase name}}_GET_ALL_REQUEST, {{camelCase name}}GetAll),
    takeLatest({{constantCase name}}_GET_ONE_REQUEST, {{camelCase name}}GetOne),
    takeLatest({{constantCase name}}_UPDATE_REQUEST, {{camelCase name}}Update)
  ])
}
